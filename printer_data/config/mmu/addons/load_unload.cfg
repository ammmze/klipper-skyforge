[gcode_macro _PRE_UNLOAD]
gcode:
    SKEW_PROFILE_SUSPEND

[gcode_macro _POST_UNLOAD]
gcode:
    {% set extruder_temp = printer['extruder'].temperature %}
    SKEW_PROFILE_RESUME
    {% if extruder_temp >= 150 %}
        CLEAN_NOZZLE
    {% else %}
        {% if printer["gcode_macro _USER_VARIABLES"].verbose %}
            RESPOND MSG="Skipping nozzle cleaning; extruder temperature ({extruder_temp}Â°C) below threshold."
        {% endif %}
    {% endif %}